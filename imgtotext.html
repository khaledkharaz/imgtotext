<!DOCTYPE html>
<html>
<head>
    <title>Image to Text Converter (Multi-File, Drag & Drop & Copy & Clear)</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        /* --- CSS Styles --- */
        body {
            font-family: sans-serif;
            padding: 20px;
        }

        h1 {
            text-align: center;
            margin-bottom: 20px;
        }

        #fileUploadSection { /* Container for "Choose File" button */
            text-align: center;
            margin-bottom: 10px;
        }

        #imageUpload {
            display: inline-block; /* To allow margin on sides */
            margin-bottom: 10px; /* Spacing below button */
        }

        #imagePreview {
            max-width: 300px;
            margin: 0 auto 10px auto; /* Center and add margin below */
            border: 2px dashed #ccc; /* Dashed border to indicate drop zone */
            padding: 20px;
            text-align: center;
            cursor: pointer; /* Change cursor to indicate it's interactive */
        }

        #imagePreview img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 0 auto; /* Center image in preview */
        }

        #buttonContainer { /* Container for Convert and Clear buttons */
            text-align: center;
            margin-bottom: 10px;
        }

        #convertButton, #clearButton {
            padding: 10px 20px;
            cursor: pointer;
            margin: 5px; /* Spacing between buttons */
        }

        #textOutputContainer { /* Container for textarea and copy button */
            display: flex;       /* Use flexbox for layout */
            flex-direction: row; /* Arrange items in a row */
            align-items: flex-start; /* Vertically align items at the start (top) */
            margin-top: 10px;
        }

        #textOutput {
            width: 100%;          /* Take up available width */
            height: 200px;
            box-sizing: border-box;
            padding: 8px;
            font-family: monospace;
            resize: vertical;      /* Allow vertical resizing of textarea */
        }

        #copyButton {
            padding: 8px 15px;
            cursor: pointer;
            margin-left: 10px;   /* Add spacing between textarea and button */
            background: none;     /* Remove default button background */
            border: none;         /* Remove default button border */
            font-size: 1.2em;     /* Adjust icon size */
            color: #555;          /* Icon color */
            opacity: 0.7;         /* Slightly transparent by default */
            transition: opacity 0.2s ease-in-out; /* Smooth opacity transition */
        }

        #copyButton:hover {
            opacity: 1;         /* Fully opaque on hover */
            color: #007bff;      /* Change color on hover */
        }

        /* Style for when dragging over the drop zone */
        #imagePreview.dragover {
            border-color: #007bff; /* Change border color when dragging over */
            background-color: #f0f7ff; /* Light background color when dragging over */
        }
    </style>
</head>
<body>

    <h1>Image to Text Converter (Multi-File, Drag & Drop & Copy & Clear)</h1>

    <div id="fileUploadSection">
        <input type="file" id="imageUpload" accept="image/*" multiple>
    </div>

    <div id="imagePreview">
        <span>Drag and drop image(s) here or click to select</span>
    </div>

    <div id="buttonContainer">
        <button id="convertButton">Convert to Text</button>
        <button id="clearButton">Clear</button>  <!-- Added Clear Button -->
    </div>


    <div id="textOutputContainer">
        <textarea id="textOutput" placeholder="Extracted text will appear here"></textarea>
        <button id="copyButton" title="Copy to clipboard">
            <i class="fa-regular fa-copy"></i> <!-- Copy Icon from Font Awesome -->
        </button>
    </div>


    <script src="https://unpkg.com/tesseract.js@v5.x/dist/tesseract.min.js"></script>
    <script>
        /* --- JavaScript Code (modified for Clear Button - Resetting File Input Value) --- */
        document.addEventListener('DOMContentLoaded', () => {
            const imageUpload = document.getElementById('imageUpload');
            const imagePreview = document.getElementById('imagePreview');
            const convertButton = document.getElementById('convertButton');
            const clearButton = document.getElementById('clearButton'); // Get Clear button
            const textOutput = document.getElementById('textOutput');
            const copyButton = document.getElementById('copyButton'); // Get copy button

            let uploadedFiles = []; // Array to store multiple uploaded/dropped files

            // --- Function to handle image loading and preview (now for multiple files) ---
            const handleImageFiles = (files) => {
                uploadedFiles = Array.from(files); // Store all files in the array
                imagePreview.innerHTML = ''; // Clear previous preview
                if (files && files.length > 0) {
                    if (files.length === 1) { // If only one file, show preview as before
                        const file = files[0];
                        if (file.type.startsWith('image/')) {
                            const reader = new FileReader();
                            reader.onload = (e) => {
                                imagePreview.innerHTML = `<img src="${e.target.result}" alt="Uploaded Image">`;
                            };
                            reader.readAsDataURL(file);
                        } else {
                            imagePreview.innerHTML = '<span>Drag and drop image(s) here or click to select</span>';
                            uploadedFiles = [];
                            alert("Please upload valid image files.");
                        }
                    } else { // For multiple files, just show filenames (simplified preview)
                        let previewContent = '<b>Multiple images selected:</b><br>';
                        for (const file of files) {
                            if (file.type.startsWith('image/')) {
                                previewContent += `${file.name}<br>`;
                            }
                        }
                        imagePreview.innerHTML = previewContent || '<span>Drag and drop image(s) here or click to select</span>'; // Show filenames or default text
                        if (previewContent === '<b>Multiple images selected:</b><br>') { // If no valid images in multiple files
                            uploadedFiles = [];
                            alert("Please upload valid image files.");
                            imagePreview.innerHTML = '<span>Drag and drop image(s) here or click to select</span>';
                        }

                    }
                } else {
                    imagePreview.innerHTML = '<span>Drag and drop image(s) here or click to select</span>';
                    uploadedFiles = [];
                }
            };


            imageUpload.addEventListener('change', (event) => {
                handleImageFiles(event.target.files); // Pass all selected files
            });

            // --- Click to select image via imagePreview area ---
            imagePreview.addEventListener('click', () => {
                imageUpload.click(); // Programmatically trigger file input click
            });


            // --- Drag and Drop Functionality ---
            imagePreview.addEventListener('dragover', (event) => {
                event.preventDefault(); // Allow drop
                imagePreview.classList.add('dragover'); // Add dragover class for styling
            });

            imagePreview.addEventListener('dragleave', () => {
                imagePreview.classList.remove('dragover'); // Remove dragover class
            });

            imagePreview.addEventListener('drop', (event) => {
                event.preventDefault(); // Prevent default browser behavior
                imagePreview.classList.remove('dragover'); // Remove dragover class

                const files = event.dataTransfer.files;
                if (files && files.length > 0) {
                    handleImageFiles(files); // Handle dropped files (plural)
                }
            });


            convertButton.addEventListener('click', async () => {
                if (uploadedFiles.length === 0) { // Check if any files are uploaded
                    alert("Please upload or drop image(s) first.");
                    return;
                }

                textOutput.value = "Processing images... Please wait...\n\n"; // Updated processing message
                let combinedText = ""; // To store text from all images

                for (const file of uploadedFiles) { // Loop through each uploaded file
                    if (!file.type.startsWith('image/')) continue; // Skip non-image files (just in case)

                    try {
                        const { data: { text } } = await Tesseract.recognize(
                            file,
                            'eng',
                            { logger: m => console.log(m) }
                        );
                        combinedText += `--- Text from ${file.name} ---\n${text}\n\n`; // Add filename as separator
                    } catch (error) {
                        console.error(`OCR Error for ${file.name}:`, error);
                        combinedText += `--- Error during OCR for ${file.name} ---\nError details in console.\n\n`;
                    }
                }

                textOutput.value = combinedText.trim(); // Set combined text to textarea, trim to remove extra whitespace at end

                if (!textOutput.value.trim()) { // If after processing all images, no text was extracted (or all errors)
                    textOutput.value = "No text extracted from the selected images or errors occurred. Check console for details.";
                }
            });

            // --- Copy to Clipboard functionality ---
            copyButton.addEventListener('click', async () => {
                const textToCopy = textOutput.value;

                if (textToCopy) {
                    try {
                        await navigator.clipboard.writeText(textToCopy);
                        // For better UX, consider replacing alert with a tooltip or temporary message
                        alert('Text copied to clipboard!');
                    } catch (err) {
                        console.error('Failed to copy text: ', err);
                        alert('Failed to copy text. Please try again.');
                    }
                } else {
                    alert('No text to copy.');
                }
            });

            // --- Clear Button Functionality ---
            clearButton.addEventListener('click', () => {
                imagePreview.innerHTML = '<span>Drag and drop image(s) here or click to select</span>';
                imagePreview.classList.remove('has-image');
                textOutput.value = "";
                uploadedFiles = [];
                imageUpload.value = ""; // Reset file input to clear selected files
            });

        });
    </script>

</body>
</html>