<!DOCTYPE html>
<html>
<head>
    <title>Image to Text Converter (Drag & Drop, Upload & Copy)</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        /* --- CSS Styles (from style.css) --- */
        body {
            font-family: sans-serif;
            padding: 20px;
        }

        h1 {
            text-align: center;
            margin-bottom: 20px;
        }

        #fileUploadSection { /* Container for "Choose File" button */
            text-align: center;
            margin-bottom: 10px;
        }

        #imageUpload {
            display: inline-block; /* To allow margin on sides */
            margin-bottom: 10px; /* Spacing below button */
        }

        #imagePreview {
            max-width: 300px;
            margin: 0 auto 10px auto; /* Center and add margin below */
            border: 2px dashed #ccc; /* Dashed border to indicate drop zone */
            padding: 20px;
            text-align: center;
            cursor: pointer; /* Change cursor to indicate it's interactive */
        }

        #imagePreview img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 0 auto; /* Center image in preview */
        }

        #convertButton {
            padding: 10px 20px;
            cursor: pointer;
            display: block; /* Make button block to center it */
            margin: 0 auto 10px auto; /* Center and add margin below */
            text-align: center; /* Ensure text is centered inside button */
        }

        #textOutputContainer { /* Container for textarea and copy button */
            display: flex;       /* Use flexbox for layout */
            flex-direction: row; /* Arrange items in a row */
            align-items: flex-start; /* Vertically align items at the start (top) */
            margin-top: 10px;
        }

        #textOutput {
            width: 100%;          /* Take up available width */
            height: 200px;
            box-sizing: border-box;
            padding: 8px;
            font-family: monospace;
            resize: vertical;      /* Allow vertical resizing of textarea */
        }

        #copyButton {
            padding: 8px 15px;
            cursor: pointer;
            margin-left: 10px;   /* Add spacing between textarea and button */
            background: none;     /* Remove default button background */
            border: none;         /* Remove default button border */
            font-size: 1.2em;     /* Adjust icon size */
            color: #555;          /* Icon color */
            opacity: 0.7;         /* Slightly transparent by default */
            transition: opacity 0.2s ease-in-out; /* Smooth opacity transition */
        }

        #copyButton:hover {
            opacity: 1;         /* Fully opaque on hover */
            color: #007bff;      /* Change color on hover */
        }

        /* Style for when dragging over the drop zone */
        #imagePreview.dragover {
            border-color: #007bff; /* Change border color when dragging over */
            background-color: #f0f7ff; /* Light background color when dragging over */
        }
    </style>
</head>
<body>

    <h1>Image to Text Converter (Drag & Drop, Upload & Copy)</h1>

    <div id="fileUploadSection">
        <input type="file" id="imageUpload" accept="image/*">
    </div>

    <div id="imagePreview">
        <span>Drag and drop image here or click to select</span>
    </div>
    <button id="convertButton">Convert to Text</button>

    <div id="textOutputContainer">
        <textarea id="textOutput" placeholder="Extracted text will appear here"></textarea>
        <button id="copyButton" title="Copy to clipboard">
            <i class="fa-regular fa-copy"></i> <!-- Copy Icon from Font Awesome -->
        </button>
    </div>


    <script src="https://unpkg.com/tesseract.js@v5.x/dist/tesseract.min.js"></script>
    <script>
        /* --- JavaScript Code (modified for Upload Button & Copy Icon) --- */
        document.addEventListener('DOMContentLoaded', () => {
            const imageUpload = document.getElementById('imageUpload');
            const imagePreview = document.getElementById('imagePreview');
            const convertButton = document.getElementById('convertButton');
            const textOutput = document.getElementById('textOutput');
            const copyButton = document.getElementById('copyButton'); // Get copy button

            let uploadedFile = null; // Variable to store the uploaded/dropped file

            // --- Function to handle image loading and preview ---
            const handleImageFile = (file) => {
                if (file && file.type.startsWith('image/')) {
                    uploadedFile = file; // Store the file
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        imagePreview.innerHTML = `<img src="${e.target.result}" alt="Uploaded Image">`;
                    };
                    reader.readAsDataURL(file);
                } else {
                    imagePreview.innerHTML = '<span>Drag and drop image here or click to select</span>';
                    uploadedFile = null;
                    if (file) {
                        alert("Please upload a valid image file.");
                    }
                }
            };


            imageUpload.addEventListener('change', (event) => {
                handleImageFile(event.target.files[0]);
            });

            // --- Click to select image via imagePreview area ---
            imagePreview.addEventListener('click', () => {
                imageUpload.click(); // Programmatically trigger file input click
            });


            // --- Drag and Drop Functionality ---
            imagePreview.addEventListener('dragover', (event) => {
                event.preventDefault(); // Allow drop
                imagePreview.classList.add('dragover'); // Add dragover class for styling
            });

            imagePreview.addEventListener('dragleave', () => {
                imagePreview.classList.remove('dragover'); // Remove dragover class
            });

            imagePreview.addEventListener('drop', (event) => {
                event.preventDefault(); // Prevent default browser behavior
                imagePreview.classList.remove('dragover'); // Remove dragover class

                const files = event.dataTransfer.files;
                if (files && files.length > 0) {
                    handleImageFile(files[0]); // Handle the first dropped file
                }
            });


            convertButton.addEventListener('click', async () => {
                const file = uploadedFile; // Use the stored uploadedFile
                if (!file) {
                    alert("Please upload or drop an image first.");
                    return;
                }

                textOutput.value = "Processing... Please wait...";
                try {
                    const { data: { text } } = await Tesseract.recognize(
                        file,
                        'eng',
                        { logger: m => console.log(m) }
                    );
                    textOutput.value = text;

                } catch (error) {
                    console.error("OCR Error:", error);
                    textOutput.value = "Error during OCR. Please try again or use a different image.";
                }
            });

            // --- Copy to Clipboard functionality ---
            copyButton.addEventListener('click', async () => {
                const textToCopy = textOutput.value;

                if (textToCopy) {
                    try {
                        await navigator.clipboard.writeText(textToCopy);
                        // For better UX, consider replacing alert with a tooltip or temporary message
                        alert('Text copied to clipboard!');
                    } catch (err) {
                        console.error('Failed to copy text: ', err);
                        alert('Failed to copy text. Please try again.');
                    }
                } else {
                    alert('No text to copy.');
                }
            });

        });
    </script>

</body>
</html>